<div class="register-component">
  <!-- Form Title -->
  <h2 class="auth-form-title">Utwórz konto</h2>
  <p class="auth-form-subtitle">
    Wypełnij formularz, aby założyć nowe konto
  </p>

  <!-- Registration Form -->
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form" novalidate>

    <!-- Email Field -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Adres email</mat-label>
        <input matInput
               type="email"
               formControlName="email"
               autocomplete="email"
               [attr.aria-describedby]="hasFieldError('email') ? 'email-error' : null">
        <mat-icon matPrefix>email</mat-icon>
        <mat-error id="email-error" *ngIf="hasFieldError('email')">
          {{ getFieldError('email') }}
        </mat-error>
        <mat-hint>Użyj prawdziwego adresu email do weryfikacji konta</mat-hint>
      </mat-form-field>
    </div>

    <!-- Password Field -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Hasło</mat-label>
        <input matInput
               [type]="hidePassword() ? 'password' : 'text'"
               formControlName="password"
               autocomplete="new-password"
               [attr.aria-describedby]="hasFieldError('password') ? 'password-error' : 'password-strength'">
        <mat-icon matPrefix>lock</mat-icon>
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="togglePasswordVisibility()"
                [attr.aria-label]="hidePassword() ? 'Pokaż hasło' : 'Ukryj hasło'"
                [attr.aria-pressed]="!hidePassword()">
          <mat-icon>{{ hidePassword() ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-error id="password-error" *ngIf="hasFieldError('password')">
          {{ getFieldError('password') }}
        </mat-error>
      </mat-form-field>

      <!-- Password Strength Indicator -->
      <div class="password-strength-container"
           id="password-strength"
           *ngIf="registerForm.get('password')?.value"
           [attr.aria-live]="registerForm.get('password')?.dirty ? 'polite' : 'off'">
        <div class="strength-header">
          <span class="strength-label">Siła hasła:</span>
          <span class="strength-text" [class]="getPasswordStrengthClass()">
            {{ strengthMessages[passwordStrength().strength] }}
          </span>
        </div>

        <div class="strength-progress">
          <div class="progress-bar" [class]="getPasswordStrengthClass()">
            <div class="progress-fill"
                 [style.width.%]="getPasswordStrengthProgress()"></div>
          </div>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements" *ngIf="passwordStrength().feedback.length > 0">
          <p class="requirements-title">Wymagania:</p>
          <ul class="requirements-list">
            <li *ngFor="let requirement of passwordStrength().feedback"
                class="requirement-item">
              <mat-icon class="requirement-icon">radio_button_unchecked</mat-icon>
              {{ requirement }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Confirm Password Field -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Potwierdź hasło</mat-label>
        <input matInput
               [type]="hideConfirmPassword() ? 'password' : 'text'"
               formControlName="confirmPassword"
               autocomplete="new-password"
               [attr.aria-describedby]="hasFieldError('confirmPassword') ? 'confirm-password-error' : null">
        <mat-icon matPrefix>lock_outline</mat-icon>
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="toggleConfirmPasswordVisibility()"
                [attr.aria-label]="hideConfirmPassword() ? 'Pokaż hasło' : 'Ukryj hasło'"
                [attr.aria-pressed]="!hideConfirmPassword()">
          <mat-icon>{{ hideConfirmPassword() ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-error id="confirm-password-error" *ngIf="hasFieldError('confirmPassword')">
          {{ getFieldError('confirmPassword') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Form Validation Summary -->
    <div class="validation-summary"
         *ngIf="validationErrors().length > 0"
         role="alert"
         aria-live="polite">
      <mat-icon class="warning-icon">warning</mat-icon>
      <div class="validation-errors">
        <p class="validation-title">Popraw następujące błędy:</p>
        <ul class="validation-list">
          <li *ngFor="let error of validationErrors()" class="validation-item">
            {{ error.message }}
          </li>
        </ul>
      </div>
    </div>

    <!-- Terms and Privacy Notice -->
    <div class="terms-notice">
      <p class="terms-text">
        Rejestrując się, akceptujesz nasze
        <a href="#" class="terms-link" tabindex="-1">Warunki korzystania z usługi</a>
        oraz
        <a href="#" class="terms-link" tabindex="-1">Politykę prywatności</a>.
      </p>
    </div>

    <!-- Submit Button -->
    <button mat-raised-button
            color="primary"
            type="submit"
            class="auth-submit-button"
            [disabled]="!isFormValid"
            [attr.aria-describedby]="isSubmitting() ? 'loading-message' : null">
      <mat-icon *ngIf="isSubmitting()" class="loading-icon">sync</mat-icon>
      <mat-icon *ngIf="!isSubmitting()">person_add</mat-icon>
      {{ submitButtonText }}
    </button>

    <!-- Loading message for screen readers -->
    <div id="loading-message"
         class="sr-only"
         *ngIf="isSubmitting()"
         aria-live="polite">
      Trwa rejestrowanie konta, proszę czekać...
    </div>

  </form>

  <!-- Divider -->
  <div class="auth-divider">
    <span>lub</span>
  </div>

  <!-- Login Link -->
  <div class="auth-link">
    <span>Masz już konto? </span>
    <a routerLink="/auth/login"
       [tabindex]="isSubmitting() ? '-1' : '0'">
      Zaloguj się
    </a>
  </div>

</div>
