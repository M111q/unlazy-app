<div class="reset-password-component">
  <!-- Form Title -->
  <h2 class="auth-form-title">{{ formTitle }}</h2>
  <p class="auth-form-subtitle">
    {{ formSubtitle }}
  </p>

  <!-- Success State -->
  <div class="success-state" *ngIf="isEmailSent()">
    <div class="success-icon-container">
      <mat-icon class="success-icon">mark_email_read</mat-icon>
    </div>

    <div class="success-message">
      <p class="success-text">
        Jeśli konto z podanym adresem email istnieje, zostanie wysłany link do resetowania hasła.
      </p>
      <p class="success-hint">
        Sprawdź swoją skrzynkę mailową oraz folder spam. Link będzie aktywny przez 1 godzinę.
      </p>
    </div>

    <div class="success-actions">
      <button mat-button
              color="primary"
              type="button"
              (click)="onResendEmail()"
              [disabled]="isSubmitting()"
              class="resend-button">
        <mat-icon *ngIf="isSubmitting()">sync</mat-icon>
        <mat-icon *ngIf="!isSubmitting()">refresh</mat-icon>
        {{ isSubmitting() ? 'Wysyłanie...' : 'Wyślij ponownie' }}
      </button>
    </div>
  </div>

  <!-- Reset Password Form -->
  <form [formGroup]="resetPasswordForm"
        (ngSubmit)="onSubmit()"
        class="reset-password-form"
        *ngIf="!isEmailSent()"
        novalidate>

    <!-- Email Field -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Adres email</mat-label>
        <input matInput
               type="email"
               formControlName="email"
               autocomplete="email"
               [attr.aria-describedby]="hasFieldError('email') ? 'email-error' : null">
        <mat-icon matPrefix>email</mat-icon>
        <mat-error id="email-error" *ngIf="hasFieldError('email')">
          {{ getFieldError('email') }}
        </mat-error>
        <mat-hint>Wprowadź adres email powiązany z Twoim kontem</mat-hint>
      </mat-form-field>
    </div>

    <!-- Form Validation Summary -->
    <div class="validation-summary"
         *ngIf="validationErrors().length > 0"
         role="alert"
         aria-live="polite">
      <mat-icon class="warning-icon">warning</mat-icon>
      <div class="validation-errors">
        <p class="validation-title">Popraw następujące błędy:</p>
        <ul class="validation-list">
          <li *ngFor="let error of validationErrors()" class="validation-item">
            {{ error.message }}
          </li>
        </ul>
      </div>
    </div>

    <!-- Submit Button -->
    <button mat-raised-button
            color="primary"
            type="submit"
            class="auth-submit-button"
            [disabled]="!isFormValid"
            [attr.aria-describedby]="isSubmitting() ? 'loading-message' : null">
      <mat-icon *ngIf="isSubmitting()" class="loading-icon">sync</mat-icon>
      <mat-icon *ngIf="!isSubmitting()">send</mat-icon>
      {{ submitButtonText }}
    </button>

    <!-- Loading message for screen readers -->
    <div id="loading-message"
         class="sr-only"
         *ngIf="isSubmitting()"
         aria-live="polite">
      Trwa wysyłanie linku resetującego, proszę czekać...
    </div>

  </form>

  <!-- Help Text -->
  <div class="help-text" *ngIf="!isEmailSent()">
    <div class="help-item">
      <mat-icon class="help-icon">info</mat-icon>
      <p class="help-description">
        Po kliknięciu przycisku otrzymasz email z linkiem do resetowania hasła.
      </p>
    </div>
    <div class="help-item">
      <mat-icon class="help-icon">schedule</mat-icon>
      <p class="help-description">
        Link będzie aktywny przez 1 godzinę od momentu wysłania.
      </p>
    </div>
  </div>

  <!-- Divider -->
  <div class="auth-divider">
    <span>lub</span>
  </div>

  <!-- Back to Login Link -->
  <div class="auth-link">
    <span>Pamiętasz hasło? </span>
    <a routerLink="/auth/login"
       [tabindex]="isSubmitting() ? '-1' : '0'">
      Zaloguj się
    </a>
  </div>

  <!-- Register Link -->
  <div class="auth-link">
    <span>Nie masz konta? </span>
    <a routerLink="/auth/register"
       [tabindex]="isSubmitting() ? '-1' : '0'">
      Zarejestruj się
    </a>
  </div>

</div>
